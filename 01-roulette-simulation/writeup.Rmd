---
title: "Roulette Simulation"
output: html_document
---

### Donald Kane
### September 6, 2021

# 1 Introduction
  The purpose of this blog post is to understand the Martingale strategy for playing roulette. The Martingale strategy tries to shift the odds that the player will always end up in the positive, something that casinos try their best to avoid. We will dive into this strategy to see whether it truly works and if changing variables can help the player win more money.

# 1.1 Background
  Roulette is a game that dates back to 18th century France. It is a wheel that is made up of 38 spaces (0, 00, and 1 through 36) and 3 colors (18 red, 18 black, and 2 green to ensure that the odds are in the house's favor). The types of bets that a player can be broken down into 2 different categories, inside and outside. Inside bets are for betting on the numbers and can used to couple up to 4 numbers on a single bet. Outside bets are for betting on the color, low or high, even or odd, etc.
  The Martingale strategy starts by placing a minimum bet (usually $1, but can change) on red. If the roulette wheel produces a red spin, the player collects their winnings and continues to bet one dollar on red. If the player loses their bet, they then double their bet until the roulette wheel hits red again. This strategy, when done correctly, ensures that the player will always end in the positive, but how much money can we win if we change the variables?

# 2 Methods

### Computer Simulation

```{r}
library(dbplyr)
one_play <- function(state){
  
  # Wager
  proposed_wager <- ifelse(state$previous_win, 1, 2*state$previous_wager)
  wager <- min(proposed_wager, state$M, state$B)
  
  # Spin of the wheel
  red <- rbinom(1,1,18/38)
  
  # Update state
  state$plays <- state$plays + 1
  state$previous_wager <- wager
  if(red){
    # WIN
    state$B <- state$B + wager
    state$previous_win <- TRUE
  }else{
    # LOSE
    state$B <- state$B - wager
    state$previous_win <- FALSE
  }
  state
}
```

Here, we need to create a function called *one_play* that will allow us to run a simulation of one roulette spin. Using *proposed_wager*, we are able to show that if we win, we continue to gamble $1, but if we lose, we double the bet until we win again. We create the simulation of the roulette wheel landing on red by using the *rbinom* function, a function that randomly assigns wins and loses using the odds of 18/38 (the true odds landing on red.) We then use this function to test whether or not we win the round, or if we need to double the bet on the next roll.

``` {r}

#' Stopping rule
stop_play <- function(state){
  if(state$B <= 0) return(TRUE)
  if(state$plays >= state$L) return(TRUE)
  if(state$B >= state$W) return(TRUE)
  FALSE
}
```

We use this *stop_play* function to tell the simulation when to stop based on multiple factors. "W" represents that the player has W dollars and the gambling must end, "L" represents the amount of roulette wheel spins limit that the player sets for themselves, and "B" represents that the player has gone bankrupt and must walk away from gambling.

```{r}
#' Play roulette to either bankruptcy, success, or play limits
one_series <- function(
  B = 200
  , W = 300
  , L = 1000
  , M = 100
){
  
  # initial state
  state <- list(
    B = B
    , W = W
    , L = L
    , M = M
    , plays = 0
    , previous_wager = 0
    , previous_win = TRUE
  )
  
  # vector to store budget over series of plays
  budget <- rep(NA, L)
  
  # For loop of plays
  for(i in 1:L){
    new_state <- state %>% one_play
    budget[i] <- new_state$B
    if(new_state %>% stop_play){
      return(budget[1:i])
    }
    state <- new_state
  }
  budget    
}
```

Now that we have a function that allows us to "spin" the roulette wheel once, we need another function that allows us to simulate the Martingale strategy. We set parameters (described below) to allow us to "sit down" at the table and start gambling. 

As we can see in the initial state:

Parameter     | Description
------------- | -------------
B             | Initial Budget
W             | Budget threshold for stopping
L             | Maximum plays
M             | Casino maximum

``` {r}
# helper function
get_last <- function(x) x[length(x)] 


# Simulation
walk_out_money <- rep(NA, 10000)
for(j in seq_along(walk_out_money)){
  walk_out_money[j] <- one_series(B = 200, W = 300, L = 1000, M = 100) %>% get_last
}
```


# 3 Results

```{r}
# Walk out money distribution
hist(walk_out_money, breaks = 100)
```

``` {r}
# Estimated probability of walking out with extra cash
mean(walk_out_money > 200)
```

```{r}
# Estimated earnings
mean(walk_out_money - 200)
```

# 3.1 Limitations

random
invalid parameters

# 4 Changing Parameters

When we ran the above simulation, we set the parameters at a \$200 budget, a \$300 winnings threshold, 1000 plays, and with a maximum casino bet at \$100. These numbers are fairly standard for anyone walking into a casino, we want to see whether one change can make a difference in how much money we walk away from the table with.

### Starting Budget

Here, we will test whether increasing the starting budget will increase our probability of walking out with extra cash. We will increase B to \$500 and W to \$600 to keep the \$100 winnings goal.

```{r}
walk_out_money <- rep(NA, 10000)
for(j in seq_along(walk_out_money)){
  walk_out_money[j] <- one_series(B = 500, W = 600, L = 1000, M = 100) %>% get_last
}

mean(walk_out_money > 500)
```

Holding all other parameters equal, we shockingly have much better odds of walking out with extra cash when we increased the starting budget from \$200 to \$500. 

### Winnings Threshold

We can also test if changing the winnings threshold will affect our odds of walking away with extra cash, so here we changed the winnings threshold parameter, W, to \$250 to represent a \$50 winnings goal.
```{r}
walk_out_money <- rep(NA, 10000)
for(j in seq_along(walk_out_money)){
  walk_out_money[j] <- one_series(B = 200, W = 250, L = 1000, M = 100) %>% get_last
}
mean(walk_out_money > 200)

```

Unsurprisingly, we see a noticeable increase in probability of walking out with extra cash when we decreased the winnings goal in half.

### Number of Plays

```{r}
walk_out_money <- rep(NA, 10000)
for(j in seq_along(walk_out_money)){
  walk_out_money[j] <- one_series(B = 200, W = 300, L = 1000, M = 100) %>% get_last
}
```

### Casino Maximum Bet

```{r}
walk_out_money <- rep(NA, 10000)
for(j in seq_along(walk_out_money)){
  walk_out_money[j] <- one_series(B = 200, W = 300, L = 1000, M = 100) %>% get_last
}
```

# 5 Conclusions

Based on the simulations ran, if we were to use the Martingale strategy while playing roulette 